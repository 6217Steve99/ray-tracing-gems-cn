
# CHAPTER 8 


## 摘要
我们通过简单的几何构建来计算光线和非平面双线性patch之间的交点。
新算法将现有算法的性能提高了6倍以上，并且相比通过两个三角形近似patch的算法更快。



## 8.1 简介与当前技术 

计算机图形学力求以其丰富的形状和颜色渲染现实世界。通常使用曲面细分以充分利用现代GPU的能力。当前两种主要的渲染模式：光栅化与光线追踪，都支持硬件优化的三角形图元。但是曲面细分的缺点在于需要大量内存占用来精确表达复杂形状。 

内容制作工具由于其简单性和表现力而倾向于使用更高阶的表面。这些表面可以直接在DirectX 11硬件管线中进行细分与光栅化[7,11]。至今为止，现代GPU并不支持非平面图元的光线追踪。

我们重新审视对于高阶图元的光线追踪，试图在三角形的简单性与诸如细分曲面[3,16],NURBS[1]和Bézier曲面[2]等平滑形状之间找到平衡点。

通常，我们用三阶（或更高阶）的表达式来生成法线连续的平滑表面。Peter[21]提出了一个通过二次和三次patch共同建模光滑曲面的方法。对于高度场，可以通过将每个三角形细分为24个小三角形来实现对任意三角形mesh的$C^{1}$二次插值。插值给定定点的位置与导数需要更多的控制点。如图8-1所示，对于一个仅有二次或分段线性patch组成的曲面，通过插值顶点法线，可以使用Phong扎找着色法[22]实现光滑表面的渲染。对于此模型，我们在接下来的部分中将要提到的intersector相较于Optix系统[20]中的优化光线/三角形intersector快7%。

Vlachos等人[26]引入了一种curved point-normal(PN)三角形，它只是用三个顶点和三个顶点的法线来创建三次Bézier patch. 对于这种表面，通过二次插值shading法线以模拟光滑光照。我们可以通过局部插值来将PN三角形转化成$G^{1}$连续表面。

Boubekeur和Alexa[6]也试图使用完全的局部表达法，并提出了Phong曲面细分的方法。他们论文的基本思想是将几何体充分膨胀以避免出现刻面。

以上这些技术，使用参数域中的采样，都非常适合光栅化。如果选择光线追踪，计算光线与这些表面的交点需要求解非线性方程。非线性方程通常需要通过迭代来求解[2,13].

三角形由其三个顶点定义。或许最简单的通过插值四个给定点$Q_{ij}$形成的，并且可以计算单步光线相交的曲面patch是双线性path，表达式为:
$$
    Q(u,v) = (1-u)(1-v)Q_{00} + (1-u)vQ_{01} + u(1-v)Q_{10} + uvQ_{11}
$$

这样的双变量表面在$\{u,v\} = \{i,j\}$时经过四个角点。如图8-4和图8-5所示，该表面是由$u=const$和$v=const$形成的双重直纹曲面。当四个角点处于同一平面时，可以通过将四边形分成两个三角形来找到一个相交点。Lagae和Dutré[15]提出了更有效的算法。

对于非平面表面，可能与光线$R(t) = o + t \hat{d}$有两个相交点。光线由起点$O$和单位方向$\hat{d}$定义。当前最好的算法由Ramsey等人[24]提出，该算法通过代数方法求解三个二次方程$R(t) = Q(u,v)$的系统。

在迭代方法中，可以通过增加迭代次数减少误差。在直接方法中，并没有对应的保证，二次方程可能会导致无边界的误差。讽刺的是，对于更平整的patch来说，出现重大误差的可能性会更大，尤其是当patch距离较远时。为了解决这个问题，Ramsey等人使用的是双精度浮点数(double)。我们将他们的算法以单精度浮点数(float)实现后发现在某些角度会产生明显误差，如图8-2所示。

找到光线和三角形的交点是一个相对简单的问题。该问题可以通过考虑基本几何结构(光线/平面交点，线之间的距离，三角形的面积，四面体体积等）简化。我们通过利用直纹曲面的特性(等式1)，将相似方法应用于光线/patch的相交问题。
虽然Hanrahan[11]提出了相似的方法，但该方法仅适用于平面情况。